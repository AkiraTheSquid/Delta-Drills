,,,,
Topic,Subtopic,Question,Answer,Problem difficulty
Numpy,Vectorization and broadcasting,Row-wise argmax of a 5x5 random int matrix (★☆☆),"Z = np.random.randint(0,10,(5,5)); print(Z.argmax(axis=1))",24
Numpy,Indexing and selection,Create a 8x8 matrix and fill it with a checkerboard pattern (★☆☆),"Z = np.zeros((8,8),dtype=int)
Z[1::2,::2] = 1
Z[::2,1::2] = 1
print(Z)",24
Numpy,Applied patterns and advanced,Create a custom dtype that describes a color as four unsigned bytes (RGBA) (★☆☆),"color = np.dtype([(""r"", np.ubyte),
                  (""g"", np.ubyte),
                  (""b"", np.ubyte),
                  (""a"", np.ubyte)])",24
Numpy,Indexing and selection,"Create a 5x5 matrix with values 1,2,3,4 just below the diagonal (★☆☆)","Z = np.diag(1+np.arange(4),k=-1)
print(Z)",24
Numpy,Vectorization and broadcasting,Compute the Frobenius norm of a 3x3 matrix (★☆☆),"Z = np.random.random((3,3)); print(np.linalg.norm(Z))",22
Numpy,Vectorization and broadcasting,Normalize a random vector to L2 norm 1 (★☆☆),v = np.random.random(5); v /= np.linalg.norm(v); print(v),22
Numpy,Vectorization and broadcasting,Subtract each row's mean from a 5x5 random matrix (★☆☆),"Z = np.random.random((5,5)); Z -= Z.mean(axis=1, keepdims=True); print(Z)",22
Numpy,Core array literacy,Create reproducible random numbers using a seed (★☆☆),rng = np.random.default_rng(42); print(rng.random(3)),22
Numpy,Applied patterns and advanced,"What is the result of the following expression? (★☆☆)
0 * np.nan
np.nan == np.nan
np.inf > np.nan
np.nan - np.nan
np.nan in set([np.nan])
0.3 == 3 * 0.1","print(0 * np.nan)
print(np.nan == np.nan)
print(np.inf > np.nan)
print(np.nan - np.nan)
print(np.nan in set([np.nan]))
print(0.3 == 3 * 0.1)",22
Numpy,Vectorization and broadcasting,Normalize a 5x5 random matrix (★☆☆),"Z = np.random.random((5,5))
Z = (Z - np.mean (Z)) / (np.std (Z))
print(Z)",22
Numpy,Indexing and selection,Create a 4x4 matrix of row indices (★☆☆),"Z = np.indices((4,4))[0]; print(Z)",22
Numpy,Indexing and selection,"Given a 1D array, negate all elements which are between 3 and 8, in place. (★☆☆)","# Author: Evgeni Burovski

Z = np.arange(11)
Z[(3 < Z) & (Z < 8)] *= -1
print(Z)",26
Numpy,Core array literacy,"Consider a (6,7,8) shape array, what is the index (x,y,z) of the 100th element? (★☆☆)","print(np.unravel_index(99,(6,7,8)))",26
Numpy,Indexing and selection,Find unique values and counts in an array (★☆☆),"Z = np.array([1,2,2,3,3,3]); vals, cnts = np.unique(Z, return_counts=True); print(vals, cnts)",20
Numpy,Vectorization and broadcasting,Center a 3x3 matrix by subtracting its mean (★☆☆),"Z = np.random.random((3,3)); Z = Z - Z.mean(); print(Z)",20
Numpy,Core array literacy,Create a 5x5 strict lower triangular matrix of ones (★☆☆),"Z = np.tril(np.ones((5,5)), k=-1); print(Z)",20
Numpy,Indexing and selection,How to add a border (filled with 0's) around an existing array? (★☆☆),"Z = np.ones((5,5))
Z = np.pad(Z, pad_width=1, mode='constant', constant_values=0)
print(Z)

# Using fancy indexing
Z[:, [0, -1]] = 0
Z[[0, -1], :] = 0
print(Z)",20
Numpy,Core array literacy,Replace NaNs with zero (★☆☆),"Z = np.array([0.0, np.nan, 1.0]); Z = np.nan_to_num(Z, nan=0.0); print(Z)",20
Numpy,Core array literacy,Get real and imaginary parts of complex array (★☆☆),"Z = np.array([1+2j, 3+4j]); print(np.real(Z), np.imag(Z))",20
Numpy,Applied patterns and advanced,"What is the output of the following script? (★☆☆)
# Author: Jake VanderPlas

print(sum(range(5),-1))
from numpy import *
print(sum(range(5),-1))","# Author: Jake VanderPlas

print(sum(range(5),-1))
from numpy import *
print(sum(range(5),-1))",28
Numpy,Applied patterns and advanced,"Consider an integer vector Z, which of these expressions are legal? (★☆☆)
Z**Z
2 << Z >> 2
Z <- Z
1j*Z
Z/1/1
Z<Z>Z","Z**Z
2 << Z >> 2
Z <- Z
1j*Z
Z/1/1
Z<Z>Z",28
Numpy,Indexing and selection,Compute differences along rows of a 3x3 matrix (★☆☆),"Z = np.arange(9).reshape(3,3); print(np.diff(Z, axis=1))",18
Numpy,Vectorization and broadcasting,Flatten a 3x4 matrix in column-major order (★☆☆),"Z = np.arange(12).reshape(3,4); print(Z.flatten('F'))",18
Numpy,Core array literacy,Replace the maximum of a random vector with 0 (★☆☆),Z = np.random.random(10); Z[Z.argmax()] = 0; print(Z),18
Numpy,Core array literacy,Swap the first and last rows of a 3x3 matrix (★☆☆),"Z = np.arange(9).reshape(3,3); Z[[0,2]] = Z[[2,0]]; print(Z)",18
Numpy,Core array literacy,Create a 10x10 array with random values and find the minimum and maximum values (★☆☆),"Z = np.random.random((10,10))
Zmin, Zmax = Z.min(), Z.max()
print(Zmin, Zmax)",18
Numpy,Indexing and selection,Create a 2d array with 1 on the border and 0 inside (★☆☆),"Z = np.ones((10,10))
Z[1:-1,1:-1] = 0
print(Z)",18
Numpy,Core array literacy,Create a random vector of size 30 and find the mean value (★☆☆),"Z = np.random.random(30)
m = Z.mean()
print(m)",18
Numpy,Core array literacy,"Create meshgrid for x=[0,1,2], y=[0,1] (★☆☆)","x, y = np.meshgrid(np.arange(3), np.arange(2)); print(x); print(y)",18
Numpy,Core array literacy,Swap the first and last columns of a 3x3 matrix (★☆☆),"Z = np.arange(9).reshape(3,3); Z[:,[0,2]] = Z[:,[2,0]]; print(Z)",18
Numpy,Core array literacy,Create a 5x5 upper triangular matrix of ones (★☆☆),"Z = np.triu(np.ones((5,5))); print(Z)",18
Numpy,Core array literacy,Check if any element is NaN (★☆☆),"Z = np.array([0.0, np.nan, 1.0]); print(np.isnan(Z).any())",18
Numpy,Applied patterns and advanced,"What are the result of the following expressions? (★☆☆)
np.array(0) / np.array(0)
np.array(0) // np.array(0)
np.array([np.nan]).astype(int).astype(float)","print(np.array(0) / np.array(0))
print(np.array(0) // np.array(0))
print(np.array([np.nan]).astype(int).astype(float))",30
Numpy,Core array literacy,"Tile [1,2,3] three times (★☆☆)","Z = np.array([1,2,3]); print(np.tile(Z, 3))",16
Numpy,Core array literacy,"Repeat each element of [1,2,3] three times (★☆☆)","Z = np.array([1,2,3]); print(np.repeat(Z, 3))",16
Numpy,Core array literacy,"Reshape a vector of size 12 to shape (2,2,3) (★☆☆)","Z = np.arange(12).reshape(2,2,3); print(Z.shape)",16
Numpy,Vectorization and broadcasting,Compute dot product of two length-3 random vectors (★☆☆),"a = np.random.random(3); b = np.random.random(3); print(np.dot(a,b))",16
Numpy,Indexing and selection,Index of the minimum in a random vector (★☆☆),Z = np.random.random(10); print(Z.argmin()),16
Numpy,Core array literacy,How to get the documentation of the numpy add function from the command line? (★☆☆),"%run `python -c ""import numpy; numpy.info(numpy.add)""`",16
Numpy,Indexing and selection,"Find indices of non-zero elements from [1,2,0,0,4,0] (★☆☆)","nz = np.nonzero([1,2,0,0,4,0])
print(nz)",16
Numpy,Core array literacy,"Create zeros_like an existing (2,3,4) array (★☆☆)","a = np.empty((2,3,4)); Z = np.zeros_like(a); print(Z.shape)",16
Numpy,Core array literacy,Create a 3x3x3 array with random values (★☆☆),"Z = np.random.random((3,3,3))
print(Z)",16
Numpy,Vectorization and broadcasting,Element-wise maximum of two arrays (★☆☆),"a = np.array([1,5,3]); b = np.array([2,4,3]); print(np.maximum(a,b))",16
Numpy,Applied patterns and advanced,"Is the following expressions true? (★☆☆)
np.sqrt(-1) == np.emath.sqrt(-1)",np.sqrt(-1) == np.emath.sqrt(-1),32
Numpy,Applied patterns and advanced,How to ignore all numpy warnings (not recommended)? (★☆☆),"# Suicide mode on
defaults = np.seterr(all=""ignore"")
Z = np.ones(1) / 0

# Back to sanity
_ = np.seterr(**defaults)

# Equivalently with a context manager
with np.errstate(all=""ignore""):
    np.arange(3) / 0",32
Numpy,Core array literacy,Create a 3x3 matrix with values ranging from 0 to 8 (★☆☆),"Z = np.arange(9).reshape(3, 3)
print(Z)",14
Numpy,Core array literacy,"Create a 3x3 matrix with diagonal values 1,2,3 (★☆☆)",Z = np.diag(1 + np.arange(3)); print(Z),14
Numpy,Vectorization and broadcasting,Set odd indices of a vector 0..9 to -1 (★☆☆),Z = np.arange(10); Z[1::2] = -1; print(Z),14
Numpy,Core array literacy,Remove fractional parts from a float array (★☆☆),"Z = np.array([1.2, 3.7, -0.3]); print(np.floor(Z))",14
Numpy,Core array literacy,Create a 4x4 matrix with 2s on the diagonal (★☆☆),Z = np.eye(4) * 2; print(Z),14
Numpy,Core array literacy,How to find the memory size of any array (★☆☆),"Z = np.zeros((10,10))
print(""%d bytes"" % (Z.size * Z.itemsize))

# Simpler alternative
print(""%d bytes"" % Z.nbytes)",14
Numpy,Indexing and selection,Count the number of True values in a boolean array (★☆☆),"Z = np.array([True, False, True, True]); print(np.count_nonzero(Z))",12
Numpy,Core array literacy,Generate 5 evenly spaced numbers from 0 to 1 (★☆☆),"Z = np.linspace(0, 1, 5); print(Z)",12
Numpy,Core array literacy,"Convert degrees to radians for [0,90,180] (★☆☆)","print(np.deg2rad([0,90,180]))",12
Numpy,Applied patterns and advanced,How to get all the dates corresponding to the month of July 2016? (★★☆),"Z = np.arange('2016-07', '2016-08', dtype='datetime64[D]')
print(Z)",40
Numpy,Core array literacy,Consider a generator function that generates 10 integers and use it to build an array (★☆☆),"def generate():
    for x in range(10):
        yield x
Z = np.fromiter(generate(),dtype=float,count=-1)
print(Z)",42
Numpy,Core array literacy,How to print all the values of an array? (★★☆),"np.set_printoptions(threshold=float(""inf""))
Z = np.zeros((40,40))
print(Z)",44
Numpy,Core array literacy,Create a random vector of size 10 and sort it (★★☆),"Z = np.random.random(10)
Z.sort()
print(Z)",46
Numpy,Vectorization and broadcasting,How to compute ((A+B)*(-A/2)) in place (without copy)? (★★☆),"A = np.ones(3)*1
B = np.ones(3)*2
np.add(A,B,out=B)
np.divide(A,2,out=A)
np.negative(A,out=A)
np.multiply(A,B,out=A)",48
Numpy,Vectorization and broadcasting,Create a 5x5 matrix with row values ranging from 0 to 4 (★★☆),"Z = np.zeros((5,5))
Z += np.arange(5)
print(Z)

# without broadcasting
Z = np.tile(np.arange(0, 5), (5,1))
print(Z)",50
Numpy,Indexing and selection,How to find the closest value (to a given scalar) in a vector? (★★☆),"Z = np.arange(100)
v = np.random.uniform(0,100)
index = (np.abs(Z-v)).argmin()
print(Z[index])",50
Numpy,Vectorization and broadcasting,How to sum a small array faster than np.sum? (★★☆),"# Author: Evgeni Burovski

Z = np.arange(10)
print(np.add.reduce(Z))",50
Numpy,Vectorization and broadcasting,Extract the integer part of a random array of positive numbers using 4 different methods (★★☆),"Z = np.random.uniform(0,10,10)

print(Z - Z%1)
print(Z // 1)
print(np.floor(Z))
print(Z.astype(int))
print(np.trunc(Z))",50
Numpy,Vectorization and broadcasting,"Consider two random arrays A and B, check if they are equal (★★☆)","A = np.random.randint(0,2,5)
B = np.random.randint(0,2,5)

# Assuming identical shape of the arrays and a tolerance for the comparison of values
equal = np.allclose(A,B)
print(equal)

# Checking both the shape and the element values, no tolerance (values have to be exactly equal)
equal = np.array_equal(A,B)
print(equal)",54
Numpy,Vectorization and broadcasting,Make an array immutable (read-only) (★★☆),"Z = np.zeros(10)
Z.flags.writeable = False
Z[0] = 1",56
Numpy,Vectorization and broadcasting,"Consider a random 10x2 matrix representing cartesian coordinates, convert them to polar coordinates (★★☆)","Z = np.random.random((10,2))
X,Y = Z[:,0], Z[:,1]
R = np.sqrt(X**2+Y**2)
T = np.arctan2(Y,X)
print(R)
print(T)",56
Numpy,Core array literacy,Set negative values to 0 using clipping (ReLU). (★★☆),"Z = np.linspace(-3, 3, 7)
Z = Z.clip(min=0)
print(Z)",58
Numpy,Vectorization and broadcasting,Check if a 1D array is non-decreasing. (★★☆),"Z = np.array([1,2,2,4,5])
is_mono = np.all(np.diff(Z) >= 0)
print(is_mono)",58
Numpy,Core array literacy,Repeat each element of a vector a variable number of times. (★★☆),"x = np.array([1,2,3])
repeats = np.array([1,3,2])
y = np.repeat(x, repeats)
print(y)",58
Numpy,Core array literacy,Shuffle the rows of a 2D array. (★★☆),"Z = np.arange(12).reshape(4,3)
perm = np.random.permutation(Z.shape[0])
print(Z[perm])",58
Numpy,Indexing and selection,Map integer labels to new values using fancy indexing. (★★☆),"labels = np.array([0,2,1,2,0])
values = np.array([10, 20, 30])
mapped = values[labels]
print(mapped)",58
Numpy,Indexing and selection,Create an 8x8 checkerboard array using slicing. (★★☆),"Z = np.zeros((8,8), dtype=int)
Z[1::2, ::2] = 1
Z[::2, 1::2] = 1
print(Z)",58
Numpy,Indexing and selection,What is the equivalent of enumerate for numpy arrays? (★★☆),"Z = np.arange(9).reshape(3,3)
for index, value in np.ndenumerate(Z):
    print(index, value)
for index in np.ndindex(Z.shape):
    print(index, Z[index])",58
Numpy,Vectorization and broadcasting,Set every 3rd element of a vector to -1. (★★☆),"Z = np.arange(12)
Z[::3] = -1
print(Z)",58
Numpy,Core array literacy,Rotate a 2D array by 90 degrees counterclockwise. (★★☆),"Z = np.arange(9).reshape(3,3)
R = np.rot90(Z)
print(R)",58
Numpy,Core array literacy,Flip a 2D array horizontally and vertically. (★★☆),"Z = np.arange(9).reshape(3,3)
H = Z[:, ::-1]
V = Z[::-1, :]
print(H)
print(V)",58
Numpy,Core array literacy,Extract the first superdiagonal (k=1) of a square matrix. (★★☆),"Z = np.arange(25).reshape(5,5)
d = np.diag(Z, k=1)
print(d)",58
Numpy,Indexing and selection,Create a boolean mask for the upper triangular part including diagonal. (★★☆),"n = 5
mask = np.triu(np.ones((n,n), dtype=bool))
print(mask)",58
Numpy,Indexing and selection,Get unique rows of a 2D array. (★★☆),"Z = np.array([[1,2,3],[1,2,3],[2,3,4]])
U = np.unique(Z, axis=0)
print(U)",58
Numpy,Vectorization and broadcasting,"Min-max scale a vector to the [0,1] interval. (★★☆)","Z = np.random.rand(10)
Z = (Z - Z.min()) / (Z.ptp())
print(Z)",58
Numpy,Vectorization and broadcasting,Tile a 1D vector into a 2D matrix and compute column means. (★★☆),"v = np.arange(5)
M = np.tile(v, (4,1))
cm = M.mean(axis=0)
print(M)
print(cm)",58
Numpy,Vectorization and broadcasting,Compute row-wise cumulative sums of a 2D array. (★★☆),"Z = np.arange(12).reshape(3,4)
R = Z.cumsum(axis=1)
print(R)",58
Numpy,Applied patterns and advanced,"Create a structured array with `x` and `y` coordinates covering the [0,1]x[0,1] area (★★☆)","Z = np.zeros((5,5), [('x',float),('y',float)])
Z['x'], Z['y'] = np.meshgrid(np.linspace(0,1,5),
                             np.linspace(0,1,5))
print(Z)",58
Numpy,Vectorization and broadcasting,Stack two arrays along a new axis and take the mean. (★★☆),"A = np.random.rand(3,4)
B = np.random.rand(3,4)
S = np.stack([A,B], axis=0).mean(axis=0)
print(S)",58
Numpy,Vectorization and broadcasting,Remove all-zero rows from a 2D array. (★★☆),"Z = np.array([[0,0,0],[1,0,2],[0,0,0],[3,4,5]])
Z = Z[~(Z==0).all(axis=1)]
print(Z)",58
Numpy,Indexing and selection,Get coordinates of nonzero elements from a binary mask. (★★☆),"Z = np.zeros((4,5), dtype=int)
Z[1,2] = 1; Z[3,4] = 1
coords = np.argwhere(Z)
print(coords)",58
Numpy,Indexing and selection,Compute a histogram of values with 5 bins and return bin counts. (★★☆),"Z = np.random.rand(100)
counts, edges = np.histogram(Z, bins=5, range=(0.0, 1.0))
print(counts)
print(edges)",60
Numpy,Applied patterns and advanced,Print the minimum and maximum representable values for each numpy scalar type (★★☆),"for dtype in [np.int8, np.int32, np.int64]:
   print(np.iinfo(dtype).min)
   print(np.iinfo(dtype).max)
for dtype in [np.float32, np.float64]:
   print(np.finfo(dtype).min)
   print(np.finfo(dtype).max)
   print(np.finfo(dtype).eps)",60
Numpy,Vectorization and broadcasting,Interleave two equal-length vectors elementwise. (★★☆),"a = np.array([1,3,5])
b = np.array([2,4,6])
out = np.ravel(np.column_stack((a,b)))
print(out)",60
Numpy,Vectorization and broadcasting,Pad a 2D array with a constant 1-wide border of -1. (★★☆),"Z = np.ones((3,3), dtype=int)
P = np.pad(Z, pad_width=1, mode='constant', constant_values=-1)
print(P)",60
Numpy,Indexing and selection,How to randomly place p elements in a 2D array? (★★☆),"# Author: Divakar

n = 10
p = 3
Z = np.zeros((n,n))
np.put(Z, np.random.choice(range(n*n), p, replace=False),1)
print(Z)",60
Numpy,Indexing and selection,How to sort an array by the nth column? (★★☆),"# Author: Steve Tjoa

Z = np.random.randint(0,10,(3,3))
print(Z)
print(Z[Z[:,1].argsort()])",60
Numpy,Vectorization and broadcasting,One-hot encode integer labels from 0..K-1. (★★☆),"labels = np.array([0,2,1,2])
K = labels.max() + 1
onehot = np.eye(K)[labels]
print(onehot)",60
Numpy,Indexing and selection,Mask elements of an array where another array exceeds 0.5. (★★☆),"Z = np.random.rand(4,4)
Y = np.random.rand(4,4)
Z[Y > 0.5] = -1
print(Z)",60
Numpy,Vectorization and broadcasting,Convert an RGB image to grayscale using dot product. (★★☆),"I = np.random.randint(0, 256, (4,4,3)).astype(np.uint8)
G = np.dot(I[...,:3], [0.299, 0.587, 0.114])
print(G)",60
Numpy,Applied patterns and advanced,"Create a structured array representing a position (x,y) and a color (r,g,b) (★★☆)","Z = np.zeros(10, [ ('position', [ ('x', float, 1),
                                  ('y', float, 1)]),
                   ('color',    [ ('r', float, 1),
                                  ('g', float, 1),
                                  ('b', float, 1)])])
print(Z)",60
Numpy,Vectorization and broadcasting,Normalize a vector to unit L2 length. (★★☆),"Z = np.random.rand(10)
Z = Z / np.linalg.norm(Z)
print(Z)",60
Numpy,Indexing and selection,Find the nearest value from a given value in an array (★★☆),"Z = np.random.uniform(0,1,10)
z = 0.5
m = Z.flat[np.abs(Z - z).argmin()]
print(m)",60
Numpy,Indexing and selection,Compute a 1D moving average with window size 3 using convolution. (★★☆),"x = np.arange(10, dtype=float)
kernel = np.ones(3)/3.0
ma = np.convolve(x, kernel, mode='valid')
print(ma)",60
Numpy,Core array literacy,"Safely divide two arrays, treating division by zero as 0. (★★☆)","a = np.array([1.0, 2.0, 0.0])
b = np.array([2.0, 0.0, 3.0])
out = np.divide(a, b, out=np.zeros_like(a), where=b!=0)
print(out)",60
Numpy,Indexing and selection,Randomly select k unique rows from a 2D array. (★★☆),"Z = np.random.randint(0,10,(10,3))
k = 4
idx = np.random.choice(Z.shape[0], k, replace=False)
print(Z[idx])",60
Numpy,Indexing and selection,"Get unique values and their counts, sorted by count desc. (★★☆)","Z = np.random.randint(0,5,20)
vals, cnts = np.unique(Z, return_counts=True)
order = np.argsort(cnts)[::-1]
print(vals[order])
print(cnts[order])",60
Numpy,Indexing and selection,Compute softmax over a vector. (★★☆),"z = np.array([1.0, 2.0, 3.0])
e = np.exp(z - z.max())
softmax = e / e.sum()
print(softmax)",60
Numpy,Core array literacy,Generate a random permutation matrix of size n. (★★☆),"n = 5
P = np.eye(n)[np.random.permutation(n)]
print(P)",60
Numpy,Applied patterns and advanced,Generate a generic 2D Gaussian-like array (★★☆),"X, Y = np.meshgrid(np.linspace(-1,1,10), np.linspace(-1,1,10))
D = np.sqrt(X*X+Y*Y)
sigma, mu = 1.0, 0.0
G = np.exp(-( (D-mu)**2 / ( 2.0 * sigma**2 ) ) )
print(G)",62
Numpy,Vectorization and broadcasting,Standardize each column of a matrix to zero mean and unit std. (★★☆),"X = np.random.randn(5, 4)
X = (X - X.mean(axis=0)) / X.std(axis=0, ddof=0)
print(X)",62
Numpy,Core array literacy,Solve a linear system Ax = b for a random 3x3 A. (★★☆),"A = np.random.rand(3,3)
b = np.random.rand(3)
x = np.linalg.solve(A, b)
print(x)",62
Numpy,Vectorization and broadcasting,"Compute column-wise quartiles (0.25, 0.5, 0.75). (★★☆)","X = np.random.randn(100,3)
q = np.quantile(X, [0.25, 0.5, 0.75], axis=0)
print(q)",62
Numpy,Vectorization and broadcasting,Subtract the mean of each row of a matrix (★★☆),"# Author: Warren Weckesser

X = np.random.rand(5, 10)

# Recent versions of numpy
Y = X - X.mean(axis=1, keepdims=True)

# Older versions of numpy
Y = X - X.mean(axis=1).reshape(-1, 1)

print(Y)",62
Numpy,Indexing and selection,Find the bounding box of nonzero entries in a 2D array. (★★☆),"Z = np.zeros((6,7), dtype=int)
Z[2:5, 3:6] = 1
rows = np.any(Z, axis=1)
cols = np.any(Z, axis=0)
rmin, rmax = np.where(rows)[0][[0, -1]]
cmin, cmax = np.where(cols)[0][[0, -1]]
print((rmin, rmax, cmin, cmax))",62
Numpy,Applied patterns and advanced,"Considering two arrays with shape (1,3) and (3,1), how to compute their sum using an iterator? (★★☆)","A = np.arange(3).reshape(3,1)
B = np.arange(3).reshape(1,3)
it = np.nditer([A,B,None])
for x,y,z in it: z[...] = x + y
print(it.operands[2])",62
Numpy,Core array literacy,Keep only elements within k=1 diagonal band of a square matrix. (★★☆),"Z = np.arange(25).reshape(5,5)
mask = np.abs(np.arange(5)[:,None] - np.arange(5)[None,:]) <= 1
Z = Z * mask
print(Z)",62
Numpy,Applied patterns and advanced,Create an array class that has a name attribute (★★☆),"class NamedArray(np.ndarray):
    def __new__(cls, array, name=""no name""):
        obj = np.asarray(array).view(cls)
        obj.name = name
        return obj
    def __array_finalize__(self, obj):
        if obj is None: return
        self.name = getattr(obj, 'name', ""no name"")

Z = NamedArray(np.arange(10), ""range_10"")
print (Z.name)",62
Numpy,Vectorization and broadcasting,Rank elements within a vector (0-based) using argsort twice. (★★☆),"Z = np.array([10, 40, 20, 30])
ranks = Z.argsort().argsort()
print(ranks)",62
Numpy,Indexing and selection,How to tell if a given 2D array has null columns? (★★☆),"# Author: Warren Weckesser

# null : 0 
Z = np.random.randint(0,3,(3,10))
print((~Z.any(axis=0)).any())

# null : np.nan
Z=np.array([
    [0,1,np.nan],
    [1,2,np.nan],
    [4,5,np.nan]
])
print(np.isnan(Z).all(axis=0))",62
Numpy,Core array literacy,Create a 2D Manhattan distance map from the center. (★★☆),"n = 5
Y, X = np.ogrid[:n, :n]
center = (n//2, n//2)
D = np.abs(Y - center[0]) + np.abs(X - center[1])
print(D)",62
Numpy,Core array literacy,Create sliding window views (size=3) over a 1D array. (★★☆),"x = np.arange(7)
from numpy.lib.stride_tricks import sliding_window_view
W = sliding_window_view(x, window_shape=3)
print(W)",64
Numpy,Applied patterns and advanced,"Given two arrays, X and Y, construct the Cauchy matrix C (Cij =1/(xi - yj)) (★★☆)","# Author: Evgeni Burovski

X = np.arange(8)
Y = X + 0.5
C = 1.0 / np.subtract.outer(X, Y)
print(np.linalg.det(C))",64
Numpy,Vectorization and broadcasting,Find indices of the top-3 largest elements in a vector. (★★☆),"Z = np.random.rand(10)
k = 3
idx = np.argpartition(Z, -k)[-k:]
idx = idx[np.argsort(Z[idx])[::-1]]
print(idx)",64
Numpy,Vectorization and broadcasting,Replace NaNs in each column with the column mean. (★★☆),"X = np.random.randn(5,4)
X[::2, 1] = np.nan
col_means = np.nanmean(X, axis=0)
idx = np.where(np.isnan(X))
X[idx] = np.take(col_means, idx[1])
print(X)",64
Numpy,Vectorization and broadcasting,Batched dot products of row-aligned vectors using einsum. (★★☆),"A = np.random.rand(5,4)
B = np.random.rand(5,4)
dots = np.einsum('ij,ij->i', A, B)
print(dots)",64
Numpy,Indexing and selection,Compute the correlation matrix between columns. (★★☆),"X = np.random.randn(100,4)
C = np.corrcoef(X, rowvar=False)
print(C)",64
Numpy,Applied patterns and advanced,How to convert a float (32 bits) array into an integer (32 bits) array in place?,"# Thanks Vikas (https://stackoverflow.com/a/10622758/5989906)
# & unutbu (https://stackoverflow.com/a/4396247/5989906)
Z = (np.random.rand(10)*100).astype(np.float32)
Y = Z.view(np.int32)
Y[:] = Z
print(Y)",64
Numpy,Core array literacy,"For each row, set only the max element to 1 and others to 0. (★★☆)","Z = np.random.rand(4,5)
idx = Z.argmax(axis=1)
out = np.zeros_like(Z)
out[np.arange(Z.shape[0]), idx] = 1
print(out)",64
Numpy,Applied patterns and advanced,"How to read the following file? (★★☆)
1, 2, 3, 4, 5
6,  ,  , 7, 8
 ,  , 9,10,11","from io import StringIO

# Fake file
s = StringIO('''1, 2, 3, 4, 5

                6,  ,  , 7, 8

                 ,  , 9,10,11
''')
Z = np.genfromtxt(s, delimiter=',', dtype=np.int)
print(Z)",64
Numpy,Indexing and selection,Compute block sums by reshaping a 2D array into 2x2 blocks. (★★☆),"Z = np.arange(4*6).reshape(4,6)
Z2 = Z.reshape(2,2,3,2)
block_sums = Z2.sum(axis=(1,3))
print(block_sums)",66
Numpy,Applied patterns and advanced,"Consider a random vector with shape (100,2) representing coordinates, find point by point distances (★★☆)","Z = np.random.random((10,2))
X,Y = np.atleast_2d(Z[:,0], Z[:,1])
D = np.sqrt( (X-X.T)**2 + (Y-Y.T)**2)
print(D)

# Much faster with scipy
import scipy
# Thanks Gavin Heverly-Coulson (#issue 1)
import scipy.spatial

Z = np.random.random((10,2))
D = scipy.spatial.distance.cdist(Z,Z)
print(D)",66
Numpy,Indexing and selection,Compute cosine similarity matrix between row vectors. (★★☆),"X = np.random.rand(5,4)
norms = np.linalg.norm(X, axis=1, keepdims=True)
S = (X @ X.T) / (norms @ norms.T)
print(S)",66
Numpy,Indexing and selection,Compute k=2 nearest neighbors (indices) for points in 2D. (★★☆),"Z = np.random.rand(6,2)
X, Y = Z[:,None,:], Z[None,:,:]
dist2 = ((X - Y)**2).sum(axis=2)
k = 2
idx = np.argpartition(dist2, kth=k+1, axis=1)[:, 1:k+1]
print(idx)",66
Numpy,Vectorization and broadcasting,Index of first nonzero element in each row (or -1 if none). (★★☆),"Z = np.array([[0,0,3],[0,2,0],[0,0,0]])
mask = Z != 0
idx = np.where(mask.any(axis=1), mask.argmax(axis=1), -1)
print(idx)",66
Numpy,Applied patterns and advanced,"Consider a given vector, how to add 1 to each element indexed by a second vector (be careful with repeated indices)? (★★★)","# Author: Brett Olsen

Z = np.ones(10)
I = np.random.randint(0,len(Z),20)
Z += np.bincount(I, minlength=len(Z))
print(Z)

# Another solution
# Author: Bartosz Telenczuk
np.add.at(Z, I, 1)
print(Z)",72
Numpy,Applied patterns and advanced,How to accumulate elements of a vector (X) to an array (F) based on an index list (I)? (★★★),"# Author: Alan G Isaac

X = [1,2,3,4,5,6]
I = [1,3,9,3,4,1]
F = np.bincount(I,X)
print(F)",74
Numpy,Applied patterns and advanced,"Considering a (w,h,3) image of (dtype=ubyte), compute the number of unique colors (★★☆)","# Author: Fisher Wang

w, h = 256, 256
I = np.random.randint(0, 4, (h, w, 3)).astype(np.ubyte)
colors = np.unique(I.reshape(-1, 3), axis=0)
n = len(colors)
print(n)

# Faster version
# Author: Mark Setchell
# https://stackoverflow.com/a/59671950/2836621

w, h = 256, 256
I = np.random.randint(0,4,(h,w,3), dtype=np.uint8)

# View each pixel as a single 24-bit integer, rather than three 8-bit bytes
I24 = np.dot(I.astype(np.uint32),[1,256,65536])

# Count unique colours
n = len(np.unique(I24))
print(n)",76
Numpy,Vectorization and broadcasting,How to find the most frequent value in an array?,"Z = np.random.randint(0,10,50)
print(np.bincount(Z).argmax())",78
Numpy,Vectorization and broadcasting,"Considering a four dimensions array, how to get sum over the last two axis at once? (★★★)","A = np.random.randint(0,10,(3,4,3,4))
# solution by passing a tuple of axes (introduced in numpy 1.7.0)
sum = A.sum(axis=(-2,-1))
print(sum)
# solution by flattening the last two dimensions into one
# (useful for functions that don't accept tuples for axis argument)
sum = A.reshape(A.shape[:-2] + (-1,)).sum(axis=-1)
print(sum)",78
Numpy,Indexing and selection,How to swap two rows of an array? (★★★),"# Author: Eelco Hoogendoorn

A = np.arange(25).reshape(5,5)
A[[0,1]] = A[[1,0]]
print(A)",80
Numpy,Applied patterns and advanced,"Considering a one-dimensional vector D, how to compute means of subsets of D using a vector S of same size describing subset  indices? (★★★)","# Author: Jaime Fernández del Río

D = np.random.uniform(0,1,100)
S = np.random.randint(0,10,100)
D_sums = np.bincount(S, weights=D)
D_counts = np.bincount(S)
D_means = D_sums / D_counts
print(D_means)

# Pandas solution as a reference due to more intuitive code
import pandas as pd
print(pd.Series(D).groupby(S).mean())",80
Numpy,Indexing and selection,Shuffle the rows of a 2D array in-place given a random permutation (★★★),"Z = np.arange(20).reshape(5,4)
p = np.random.permutation(Z.shape[0])
Z[:] = Z[p]
print(Z)",82
Numpy,Indexing and selection,Sample m distinct rows from a 2D array without replacement (★★★),"Z = np.arange(40).reshape(10,4)
m = 3
idx = np.random.choice(Z.shape[0], size=m, replace=False)
print(Z[idx])",82
Numpy,Indexing and selection,Extract the k-th diagonal (k can be negative) of a 2D array (★★★),"A = np.arange(1, 26).reshape(5,5)
k = -2
diag_k = np.diag(A, k=k)
print(diag_k)",82
Numpy,Vectorization and broadcasting,How to get the diagonal of a dot product? (★★★),"# Author: Mathieu Blondel

A = np.random.uniform(0,1,(5,5))
B = np.random.uniform(0,1,(5,5))

# Slow version
print(np.diag(np.dot(A, B)))

# Fast version
print(np.sum(A * B.T, axis=1))

# Faster version
print(np.einsum(""ij,ji->i"", A, B))",82
Numpy,Indexing and selection,Find rows containing any non-finite values (NaN or Inf) (★★★),"Z = np.random.randn(6, 4)
Z[1,2] = np.nan; Z[4,0] = np.inf
mask = ~np.isfinite(Z).all(axis=1)
print(np.where(mask)[0])",82
Numpy,Indexing and selection,Remove consecutive duplicates from a 1D array (keep first of each run) (★★★),"a = np.array([1,1,2,2,2,3,1,1,4])
mask = np.r_[True, a[1:] != a[:-1]]
out = a[mask]
print(out)",82
Numpy,Vectorization and broadcasting,Compute row-wise dot products between a 2D array and a vector without loops (★★★),"Z = np.random.rand(6, 5)
v = np.random.rand(5)
dots = Z @ v
print(dots)",82
Numpy,Indexing and selection,Find indices of strict local maxima in a 1D array (exclude endpoints) (★★★),"a = np.random.randn(20)
peaks = np.where((a[1:-1] > a[:-2]) & (a[1:-1] > a[2:]))[0] + 1
print(peaks)",82
Numpy,Vectorization and broadcasting,"Interleave two 1D arrays A and B elementwise: [a0,b0,a1,b1,...] (★★★)","A = np.arange(5)
B = 10 + np.arange(5)
C = np.empty(A.size + B.size, dtype=A.dtype)
C[0::2] = A
C[1::2] = B
print(C)",82
Numpy,Applied patterns and advanced,Winsorize a 1D array by clipping to its 5th and 95th percentiles (★★★),"Z = np.random.randn(1000)
lo, hi = np.percentile(Z, [5, 95])
Z_wins = np.clip(Z, lo, hi)
print(Z_wins.min(), Z_wins.max())",82
Numpy,Indexing and selection,"Get first occurrence indices of each unique value in a 1D array, preserving input order (★★★)","a = np.random.randint(0, 10, 20)
_, idx = np.unique(a, return_index=True)
idx_sorted = np.sort(idx)
print(idx_sorted)",82
Numpy,Vectorization and broadcasting,Compute the k-th order discrete difference of a 1D array (★★★),"a = np.arange(10)
k = 3
d = np.diff(a, n=k)
print(d)",82
Numpy,Vectorization and broadcasting,One-hot encode a label vector y with C classes using array operations (★★★),"y = np.array([0,2,1,2,0])
C = y.max() + 1
I = np.eye(C, dtype=int)
one_hot = I[y]
print(one_hot)",82
Numpy,Vectorization and broadcasting,"Consider an array of dimension (5,5,3), how to multiply it by an array with dimensions (5,5)? (★★★)","A = np.ones((5,5,3))
B = 2*np.ones((5,5))
print(A * B[:,:,None])",82
Numpy,Vectorization and broadcasting,Compute a cumulative maximum along axis=1 for a 2D array (★★★),"Z = np.random.randint(0, 100, (4, 7))
cummax = np.maximum.accumulate(Z, axis=1)
print(cummax)",83
Numpy,Vectorization and broadcasting,Normalize each row of a 2D array to unit L2 norm (★★★),"Z = np.random.rand(5, 4)
norms = np.linalg.norm(Z, axis=1, keepdims=True)
Z_unit = np.divide(Z, norms, out=np.zeros_like(Z), where=norms!=0)
print(Z_unit)",84
Numpy,Vectorization and broadcasting,"Z-score each column and clip values to [-3, 3] (★★★)","Z = np.random.randn(100, 5)
mu = Z.mean(axis=0, keepdims=True)
sd = Z.std(axis=0, ddof=0, keepdims=True)
Zz = (Z - mu) / np.where(sd==0, 1, sd)
Zc = np.clip(Zz, -3, 3)
print(Zc.min(), Zc.max())",84
Numpy,Vectorization and broadcasting,Run-length decode given values and counts to reconstruct the original array (★★★),"values = np.array([1, 3, 2, 2])
counts = np.array([2, 1, 3, 2])
decoded = np.repeat(values, counts)
print(decoded)",84
Numpy,Applied patterns and advanced,Compute the summed-area table (integral image) of a 2D array (★★★),"Z = np.random.randint(0, 5, (6, 7))
I = np.cumsum(np.cumsum(Z, axis=0), axis=1)
print(I)",84
Numpy,Applied patterns and advanced,How to create a record array from a regular array? (★★★),"Z = np.array([(""Hello"", 2.5, 3),
              (""World"", 3.6, 2)])
R = np.core.records.fromarrays(Z.T,
                               names='col1, col2, col3',
                               formats = 'S8, f8, i8')
print(R)",84
Numpy,Applied patterns and advanced,Count the number of distinct values per row of an integer matrix (★★★),"Z = np.random.randint(0, 6, (5, 8))
counts = np.apply_along_axis(lambda r: np.unique(r).size, 1, Z)
print(counts)",84
Numpy,Vectorization and broadcasting,"Consider the vector [1, 2, 3, 4, 5], how to build a new vector with 3 consecutive zeros interleaved between each value? (★★★)","# Author: Warren Weckesser

Z = np.array([1,2,3,4,5])
nz = 3
Z0 = np.zeros(len(Z) + (len(Z)-1)*(nz))
Z0[::nz+1] = Z
print(Z0)",84
Numpy,Vectorization and broadcasting,Construct a lower-triangular matrix whose i-th row contains the first i+1 elements of v (★★★),"v = np.arange(1, 6)
n = v.size
L = np.tril(np.tile(v, (n,1)))
print(L)",84
Numpy,Vectorization and broadcasting,"How to negate a boolean, or to change the sign of a float inplace? (★★★)","# Author: Nathaniel J. Smith

Z = np.random.randint(0,2,100)
np.logical_not(Z, out=Z)

Z = np.random.uniform(-1.0,1.0,100)
np.negative(Z, out=Z)",84
Numpy,Vectorization and broadcasting,Normalize each row of a 2D array so rows sum to 1 (avoid division by zero) (★★★),"Z = np.random.rand(5, 3)
row_sums = Z.sum(axis=1, keepdims=True)
Z_norm = np.divide(Z, row_sums, out=np.zeros_like(Z), where=row_sums!=0)
print(Z_norm)",84
Numpy,Indexing and selection,Find rows of a 2D array that are strictly increasing (★★★),"Z = np.random.randint(0, 10, (8, 5))
mask = np.all(np.diff(Z, axis=1) > 0, axis=1)
print(Z[mask])",84
Numpy,Vectorization and broadcasting,"Create a symmetric Toeplitz matrix from a 1D vector c (T[i,j] = c[|i-j|]) (★★★)","c = np.arange(6)
i = np.arange(c.size)[:, None]
j = np.arange(c.size)[None, :]
T = c[np.abs(i - j)]
print(T)",85
Numpy,Applied patterns and advanced,Build an undirected adjacency matrix from an integer edge list (0-indexed) (★★★),"n = 6
edges = np.array([[0,1],[0,2],[3,5],[2,5]])
A = np.zeros((n,n), dtype=int)
A[edges[:,0], edges[:,1]] = 1
A[edges[:,1], edges[:,0]] = 1
print(A)",86
Numpy,Vectorization and broadcasting,How to compute averages using a sliding window over an array? (★★★),"# Author: Jaime Fernández del Río

def moving_average(a, n=3) :
    ret = np.cumsum(a, dtype=float)
    ret[n:] = ret[n:] - ret[:-n]
    return ret[n - 1:] / n
Z = np.arange(20)
print(moving_average(Z, n=3))

# Author: Jeff Luo (@Jeff1999)
# make sure your NumPy >= 1.20.0

from numpy.lib.stride_tricks import sliding_window_view

Z = np.arange(20)
print(sliding_window_view(Z, window_shape=3).mean(axis=-1))",86
Numpy,Applied patterns and advanced,Extract all the contiguous 3x3 blocks from a random 10x10 matrix (★★★),"# Author: Chris Barker

Z = np.random.randint(0,5,(10,10))
n = 3
i = 1 + (Z.shape[0]-3)
j = 1 + (Z.shape[1]-3)
C = stride_tricks.as_strided(Z, shape=(i, j, n, n), strides=Z.strides + Z.strides)
print(C)

# Author: Jeff Luo (@Jeff1999)

Z = np.random.randint(0,5,(10,10))
print(sliding_window_view(Z, window_shape=(3, 3)))",86
Numpy,Indexing and selection,Row-wise argmax with tie-breaking by last occurrence (★★★),"Z = np.random.randint(0, 9, (4, 8))
# use argmax on reversed view, then convert index
rev = Z[:, ::-1]
idx_rev = rev.argmax(axis=1)
idx = Z.shape[1] - 1 - idx_rev
print(idx)",86
Numpy,Applied patterns and advanced,Compute cosine similarity matrix between row vectors of X (★★★),"X = np.random.rand(6, 5)
Xn = X / np.linalg.norm(X, axis=1, keepdims=True)
S = Xn @ Xn.T
print(S)",86
Numpy,Applied patterns and advanced,Replace NaNs in each column with the column mean (★★★),"Z = np.random.randn(6, 4)
Z[np.random.rand(*Z.shape) < 0.2] = np.nan
col_means = np.nanmean(Z, axis=0, keepdims=True)
inds = np.where(np.isnan(Z))
Z[inds] = np.take(col_means, inds[1])
print(Z)",86
Numpy,Applied patterns and advanced,"Given an arbitrary number of vectors, build the cartesian product (every combination of every item) (★★★)","# Author: Stefan Van der Walt

def cartesian(arrays):
    arrays = [np.asarray(a) for a in arrays]
    shape = (len(x) for x in arrays)

    ix = np.indices(shape, dtype=int)
    ix = ix.reshape(len(arrays), -1).T

    for n, arr in enumerate(arrays):
        ix[:, n] = arrays[n][ix[:, n]]

    return ix

print (cartesian(([1, 2, 3], [4, 5], [6, 7])))",86
Numpy,Applied patterns and advanced,Compute the mode along axis=1 of a small integer matrix using bincount (tie-break by smallest value) (★★★),"Z = np.random.randint(0, 5, (6, 7))
m = Z.max() + 1
mode = np.apply_along_axis(lambda r: np.bincount(r, minlength=m).argmax(), 1, Z)
print(mode)",86
Numpy,Applied patterns and advanced,Solve Ax = b for multiple right-hand sides b (columns) at once (★★★),"A = np.random.randn(5, 5)
b = np.random.randn(5, 3)
x = np.linalg.solve(A, b)
print(x)",86
Numpy,Indexing and selection,Compute the row-wise median using np.partition (odd number of columns) (★★★),"Z = np.random.rand(7, 9)
m = Z.shape[1]//2
part = np.partition(Z, m, axis=1)
med = part[:, m]
print(med)",86
Numpy,Vectorization and broadcasting,"Consider a one-dimensional array Z, build a two-dimensional array whose first row is (Z[0],Z[1],Z[2]) and each subsequent row is  shifted by 1 (last row should be (Z[-3],Z[-2],Z[-1]) (★★★)","# Author: Joe Kington / Erik Rigtorp
from numpy.lib import stride_tricks

def rolling(a, window):
    shape = (a.size - window + 1, window)
    strides = (a.strides[0], a.strides[0])
    return stride_tricks.as_strided(a, shape=shape, strides=strides)
Z = rolling(np.arange(10), 3)
print(Z)

# Author: Jeff Luo (@Jeff1999)

Z = np.arange(10)
print(sliding_window_view(Z, window_shape=3))",86
Numpy,Applied patterns and advanced,Extract all 2x4 sliding windows from a 2D array and compute their sums (★★★),"from numpy.lib.stride_tricks import sliding_window_view
Z = np.arange(8*10).reshape(8, 10)
W = sliding_window_view(Z, (2, 4))  # shape: (7, 7, 2, 4)
S = W.sum(axis=(-2, -1))
print(S)",86
Numpy,Vectorization and broadcasting,Vectorized value mapping: replace values in a 1D array using a mapping dict {old:new} (★★★),"a = np.array([1,2,3,2,1,0])
mapping = {0:9, 1:8, 2:7}
max_key = max(mapping.keys())
table = np.arange(max_key+1)
for k,v in mapping.items():
    table[k] = v
out = table[a]
print(out)",86
Numpy,Applied patterns and advanced,"Consider an array Z = [1,2,3,4,5,6,7,8,9,10,11,12,13,14], how to generate an array R = [[1,2,3,4], [2,3,4,5], [3,4,5,6], ..., [11,12,13,14]]? (★★★)","# Author: Stefan van der Walt

Z = np.arange(1,15,dtype=np.uint32)
R = stride_tricks.as_strided(Z,(11,4),(4,4))
print(R)

# Author: Jeff Luo (@Jeff1999)

Z = np.arange(1, 15, dtype=np.uint32)
print(sliding_window_view(Z, window_shape=4))",87
Numpy,Applied patterns and advanced,"Consider 2 sets of points P0,P1 describing lines (2d) and a point p, how to compute distance from p to each line i (P0[i],P1[i])? (★★★)","P0 = np.random.uniform(-10,10,(10,2))
P1 = np.random.uniform(-10,10,(10,2))
p  = np.random.uniform(-10,10,( 1,2))

def distance_faster(P0,P1,p):
    #Author: Hemanth Pasupuleti
    #Reference: https://mathworld.wolfram.com/Point-LineDistance2-Dimensional.html

    v = P1- P0 
    v[:,[0,1]] = v[:,[1,0]]
    v[:,1]*=-1 
    norm = np.linalg.norm(v,axis=1)   
    r = P0 - p
    d = np.abs(np.einsum(""ij,ij->i"",r,v)) / norm 

    return d

print(distance_faster(P0, P1, p))

##--------------- OR ---------------##
def distance_slower(P0, P1, p):
    T = P1 - P0
    L = (T**2).sum(axis=1)
    U = -((P0[:,0]-p[...,0])*T[:,0] + (P0[:,1]-p[...,1])*T[:,1]) / L
    U = U.reshape(len(U),1)
    D = P0 + U*T - p
    return np.sqrt((D**2).sum(axis=1))

print(distance_slower(P0, P1, p))",88
Numpy,Applied patterns and advanced,Create a band matrix with main diagonal d0 and first upper/lower diagonals d1 using vectorized assignment (★★★),"n = 6
d0 = 5*np.ones(n)
d1 = -1*np.ones(n-1)
M = np.zeros((n,n))
np.fill_diagonal(M, d0)
np.fill_diagonal(M[:-1,1:], d1)
np.fill_diagonal(M[1:,:-1], d1)
print(M)",88
Numpy,Applied patterns and advanced,"Compute the pairwise Euclidean distance matrix between rows of X (n,d) without explicit Python loops (★★★)","X = np.random.rand(6, 4)
diff = X[:, None, :] - X[None, :, :]
D = np.sqrt(np.sum(diff*diff, axis=-1))
print(D)",88
Numpy,Applied patterns and advanced,Apply a 2D affine transform (3x3 homogeneous) to an array of 2D points (★★★),"pts = np.random.rand(5, 2)
T = np.array([[1.2, 0.2, 0.5],
              [-0.1, 0.9, 0.1],
              [0.0, 0.0, 1.0]])
H = np.c_[pts, np.ones(len(pts))]
out = (H @ T.T)[:, :2]
print(out)",88
Numpy,Indexing and selection,Replace each element by its rank within the row (1=smallest) (★★★),"Z = np.random.rand(4, 6)
order = np.argsort(Z, axis=1)
ranks = np.empty_like(order)
ranks[np.arange(Z.shape[0])[:, None], order] = np.arange(Z.shape[1])
print(ranks + 1)",88
Numpy,Applied patterns and advanced,"Create a 2D array subclass such that Z[i,j] == Z[j,i] (★★★)","# Author: Eric O. Lebigot
# Note: only works for 2d array and value setting using indices

class Symetric(np.ndarray):
    def __setitem__(self, index, value):
        i,j = index
        super(Symetric, self).__setitem__((i,j), value)
        super(Symetric, self).__setitem__((j,i), value)

def symetric(Z):
    return np.asarray(Z + Z.T - np.diag(Z.diagonal())).view(Symetric)

S = symetric(np.random.randint(0,10,(5,5)))
S[2,3] = 42
print(S)",88
Numpy,Applied patterns and advanced,Run-length encode a 1D integer array (values and counts) without Python loops over elements (★★★),"a = np.random.randint(0, 4, 30)
starts = np.r_[0, 1 + np.flatnonzero(a[1:] != a[:-1])]
values = a[starts]
counts = np.diff(np.r_[starts, a.size])
print(values, counts)",88
Numpy,Applied patterns and advanced,"Consider an arbitrary array, write a function that extracts a subpart with a fixed shape and centered on a given element (pad with a `fill` value when necessary) (★★★)","# Author: Nicolas Rougier

Z = np.random.randint(0,10,(10,10))
shape = (5,5)
fill  = 0
position = (1,1)

R = np.ones(shape, dtype=Z.dtype)*fill
P  = np.array(list(position)).astype(int)
Rs = np.array(list(R.shape)).astype(int)
Zs = np.array(list(Z.shape)).astype(int)

R_start = np.zeros((len(shape),)).astype(int)
R_stop  = np.array(list(shape)).astype(int)
Z_start = (P-Rs//2)
Z_stop  = (P+Rs//2)+Rs%2

R_start = (R_start - np.minimum(Z_start,0)).tolist()
Z_start = (np.maximum(Z_start,0)).tolist()
R_stop = np.maximum(R_start, (R_stop - np.maximum(Z_stop-Zs,0))).tolist()
Z_stop = (np.minimum(Z_stop,Zs)).tolist()

r = tuple([slice(start,stop) for start,stop in zip(R_start,R_stop)])
z = tuple([slice(start,stop) for start,stop in zip(Z_start,Z_stop)])
R[r] = Z[z]
print(Z)
print(R)",88
Numpy,Indexing and selection,Turn each row into a binary mask of its top-2 values (1 for top-2 else 0) (★★★),"Z = np.random.rand(5, 6)
k = 2
idx = np.argpartition(Z, -k, axis=1)[:, -k:]
mask = np.zeros_like(Z, dtype=int)
mask[np.arange(Z.shape[0])[:, None], idx] = 1
print(mask)",88
Numpy,Applied patterns and advanced,"Considering a path described by two vectors (X,Y), how to sample it using equidistant samples (★★★)?","# Author: Bas Swinckels

phi = np.arange(0, 10*np.pi, 0.1)
a = 1
x = a*phi*np.cos(phi)
y = a*phi*np.sin(phi)

dr = (np.diff(x)**2 + np.diff(y)**2)**.5 # segment lengths
r = np.zeros_like(x)
r[1:] = np.cumsum(dr)                # integrate path
r_int = np.linspace(0, r.max(), 200) # regular spaced path
x_int = np.interp(r_int, r, x)       # integrate path
y_int = np.interp(r_int, r, y)",88
Numpy,Applied patterns and advanced,Rotate a 2D array by 90 degrees k times without np.rot90 (★★★),"Z = np.arange(12).reshape(3,4)
k = 1
rot = np.transpose(Z, (1,0))[:, ::-1]
if k % 4 == 0:
    R = Z
elif k % 4 == 1:
    R = rot
elif k % 4 == 2:
    R = Z[::-1, ::-1]
else:
    R = np.transpose(Z[::-1, :])
print(R)",88
Numpy,Applied patterns and advanced,Compute a matrix rank (★★★),"# Author: Stefan van der Walt

Z = np.random.uniform(0,1,(10,10))
U, S, V = np.linalg.svd(Z) # Singular Value Decomposition
threshold = len(S) * S.max() * np.finfo(S.dtype).eps
rank = np.sum(S > threshold)
print(rank)

# alternative solution:
# Author: Jeff Luo (@Jeff1999)

rank = np.linalg.matrix_rank(Z)
print(rank)",89
Numpy,Applied patterns and advanced,"Compute bootstrapped 95% confidence intervals for the mean of a 1D array X (i.e., resample the elements of an array with replacement N times, compute the mean of each sample, and then compute percentiles over the means). (★★★)","# Author: Jessica B. Hamrick

X = np.random.randn(100) # random 1D array
N = 1000 # number of bootstrap samples
idx = np.random.randint(0, X.size, (N, X.size))
means = X[idx].mean(axis=1)
confint = np.percentile(means, [2.5, 97.5])
print(confint)",90
Numpy,Vectorization and broadcasting,"Consider a large vector Z, compute Z to the power of 3 using 3 different methods (★★★)","# Author: Ryan G.

x = np.random.rand(int(5e7))

%timeit np.power(x,3)
%timeit x*x*x
%timeit np.einsum('i,i,i->i',x,x,x)",90
Numpy,Applied patterns and advanced,"For points X (n,d), find indices of k nearest neighbors for each point (self excluded) (★★★)","X = np.random.rand(8, 3)
diff = X[:, None, :] - X[None, :, :]
D2 = np.sum(diff*diff, axis=-1)
np.fill_diagonal(D2, np.inf)
k = 2
idx = np.argpartition(D2, k, axis=1)[:, :k]
print(idx)",90
Numpy,Indexing and selection,Find the indices of the top-k values per row of a 2D array using partial sorting (★★★),"Z = np.random.rand(5, 10)
k = 3
idx = np.argpartition(Z, -k, axis=1)[:, -k:]
# sort the top-k indices by actual values descending
rows = np.arange(Z.shape[0])[:, None]
idx_sorted = idx[rows, np.argsort(Z[rows, idx], axis=1)[:, ::-1]]
print(idx_sorted)",90
Numpy,Vectorization and broadcasting,"Consider a 16x16 array, how to get the block-sum (block size is 4x4)? (★★★)","# Author: Robert Kern

Z = np.ones((16,16))
k = 4
S = np.add.reduceat(np.add.reduceat(Z, np.arange(0, Z.shape[0], k), axis=0),
                                       np.arange(0, Z.shape[1], k), axis=1)
print(S)

# alternative solution:
# Author: Sebastian Wallkötter (@FirefoxMetzger)

Z = np.ones((16,16))
k = 4

windows = np.lib.stride_tricks.sliding_window_view(Z, (k, k))
S = windows[::k, ::k, ...].sum(axis=(-2, -1))

# alternative solution (by @Gattocrucco)
S = Z.reshape(4, 4, 4, 4).sum((1, 3))",90
Numpy,Applied patterns and advanced,Implement 2D valid convolution via sliding windows and tensordot (★★★),"from numpy.lib.stride_tricks import sliding_window_view
X = np.arange(7*7).reshape(7,7)
K = np.array([[1,0,-1],[1,0,-1],[1,0,-1]])
W = sliding_window_view(X, K.shape)
Y = np.tensordot(W, K, axes=K.ndim)
print(Y)",90
Numpy,Applied patterns and advanced,Build a block-diagonal matrix from a list of 2D arrays without external libraries (★★★),"arrays = [np.ones((2,3)), 2*np.ones((1,2)), 3*np.ones((3,1))]
R = sum(a.shape[0] for a in arrays)
C = sum(a.shape[1] for a in arrays)
out = np.zeros((R, C))
ri = ci = 0
for a in arrays:
    r, c = a.shape
    out[ri:ri+r, ci:ci+c] = a
    ri += r; ci += c
print(out)",90
Numpy,Applied patterns and advanced,Compute the Jaccard distance matrix for a binary matrix (rows are sets) (★★★),"B = (np.random.rand(6, 8) > 0.6).astype(int)
inter = (B[:, None, :] & B[None, :, :]).sum(-1)
union = (B[:, None, :] | B[None, :, :]).sum(-1)
J = 1 - inter / np.where(union==0, 1, union)
print(J)",90
Numpy,Applied patterns and advanced,Compute the Khatri-Rao product (column-wise Kronecker) of two matrices with the same number of columns (★★★),"A = np.array([[1,2],[3,4],[5,6]])
B = np.array([[7,8],[9,10]])
# result has shape (A_rows*B_rows, n_cols)
KR = (A[:, None, :] * B[None, :, :]).reshape(A.shape[0]*B.shape[0], A.shape[1])
print(KR)",90
Numpy,Applied patterns and advanced,Sample categories according to row-wise probability matrix P (rows sum to 1) (★★★),"P = np.random.dirichlet(np.ones(5), size=10)
u = np.random.rand(P.shape[0], 1)
cs = np.cumsum(P, axis=1)
samples = (u < cs).argmax(axis=1)
print(samples)",90
Numpy,Applied patterns and advanced,"Consider 2 sets of points P0,P1 describing lines (2d) and a set of points P, how to compute distance from each point j (P[j]) to each line i (P0[i],P1[i])? (★★★)","# Author: Italmassov Kuanysh

# based on distance function from previous question
P0 = np.random.uniform(-10, 10, (10,2))
P1 = np.random.uniform(-10,10,(10,2))
p = np.random.uniform(-10, 10, (10,2))
print(np.array([distance(P0,P1,p_i) for p_i in p]))

# Author: Yang Wu (Broadcasting)
def distance_points_to_lines(p: np.ndarray, p_1: np.ndarray, p_2: np.ndarray) -> np.ndarray:
    x_0, y_0 = p.T  # Shape -> (n points, )
    x_1, y_1 = p_1.T  # Shape -> (n lines, )
    x_2, y_2 = p_2.T  # Shape -> (n lines, )

    # Displacement vector coordinates from p_1 -> p_2
    dx = x_2 - x_1  # Shape -> (n lines, )
    dy = y_2 - y_1  # Shape -> (n lines, )

    # The 'cross product' term
    cross_term = x_2 * y_1 - y_2 * x_1  # Shape -> (n lines, )

    # Broadcast x_0, y_0 (n points, 1) and dx, dy, cross_term (1, n lines) -> (n points, n lines)
    numerator = np.abs(
        dy[np.newaxis, :] * x_0[:, np.newaxis]
        - dx[np.newaxis, :] * y_0[:, np.newaxis]
        + cross_term[np.newaxis, :]
    )
    denominator = np.sqrt(dx**2 + dy**2)  # Shape -> (n lines, )

    # Shape (n points, n lines) / (1, n_lines) -> (n points, n lines)
    return numerator / denominator[np.newaxis, :]

distance_points_to_lines(p, P0, P1)",90
Numpy,Indexing and selection,"Considering a 10x3 matrix, extract rows with unequal values (e.g. [2,2,3]) (★★★)","# Author: Robert Kern

Z = np.random.randint(0,5,(10,3))
print(Z)
# solution for arrays of all dtypes (including string arrays and record arrays)
E = np.all(Z[:,1:] == Z[:,:-1], axis=1)
U = Z[~E]
print(U)
# soluiton for numerical arrays only, will work for any number of columns in Z
U = Z[Z.max(axis=1) != Z.min(axis=1),:]
print(U)",90
Numpy,Vectorization and broadcasting,"Considering 2 vectors A & B, write the einsum equivalent of inner, outer, sum, and mul function (★★★)","# Author: Alex Riley
# Make sure to read: http://ajcr.net/Basic-guide-to-einsum/

A = np.random.uniform(0,1,10)
B = np.random.uniform(0,1,10)

np.einsum('i->', A)       # np.sum(A)
np.einsum('i,i->i', A, B) # A * B
np.einsum('i,i', A, B)    # np.inner(A, B)
np.einsum('i,j->ij', A, B)    # np.outer(A, B)",91
Numpy,Applied patterns and advanced,Convert a vector of ints into a matrix binary representation (★★★),"# Author: Warren Weckesser

I = np.array([0, 1, 2, 3, 15, 16, 32, 64, 128])
B = ((I.reshape(-1,1) & (2**np.arange(8))) != 0).astype(int)
print(B[:,::-1])

# Author: Daniel T. McDonald

I = np.array([0, 1, 2, 3, 15, 16, 32, 64, 128], dtype=np.uint8)
print(np.unpackbits(I[:, np.newaxis], axis=1))",92
Numpy,Applied patterns and advanced,"Given a two dimensional array, how to extract unique rows? (★★★)","# Author: Jaime Fernández del Río

Z = np.random.randint(0,2,(6,3))
T = np.ascontiguousarray(Z).view(np.dtype((np.void, Z.dtype.itemsize * Z.shape[1])))
_, idx = np.unique(T, return_index=True)
uZ = Z[idx]
print(uZ)

# Author: Andreas Kouzelis
# NumPy >= 1.13
uZ = np.unique(Z, axis=0)
print(uZ)",92
Numpy,Vectorization and broadcasting,How to get the n largest values of an array (★★★),"Z = np.arange(10000)
np.random.shuffle(Z)
n = 5

# Slow
print (Z[np.argsort(Z)[-n:]])

# Fast
print (Z[np.argpartition(-Z,n)[:n]])",92
Numpy,Applied patterns and advanced,"Consider a set of 10 triplets describing 10 triangles (with shared vertices), find the set of unique line segments composing all the  triangles (★★★)","# Author: Nicolas P. Rougier

faces = np.random.randint(0,100,(10,3))
F = np.roll(faces.repeat(2,axis=1),-1,axis=1)
F = F.reshape(len(F)*3,2)
F = np.sort(F,axis=1)
G = F.view( dtype=[('p0',F.dtype),('p1',F.dtype)] )
G = np.unique(G)
print(G)",93
Numpy,Applied patterns and advanced,"Consider a set of p matrices with shape (n,n) and a set of p vectors with shape (n,1). How to compute the sum of of the p matrix products at once? (result has shape (n,1)) (★★★)","# Author: Stefan van der Walt

p, n = 10, 20
M = np.ones((p,n,n))
V = np.ones((p,n,1))
S = np.tensordot(M, V, axes=[[0, 2], [0, 1]])
print(S)

# It works, because:
# M is (p,n,n)
# V is (p,n,1)
# Thus, summing over the paired axes 0 and 0 (of M and V independently),
# and 2 and 1, to remain with a (n,1) vector.",94
Numpy,Applied patterns and advanced,How to implement the Game of Life using numpy arrays? (★★★),"# Author: Nicolas Rougier

def iterate(Z):
    # Count neighbours
    N = (Z[0:-2,0:-2] + Z[0:-2,1:-1] + Z[0:-2,2:] +
         Z[1:-1,0:-2]                + Z[1:-1,2:] +
         Z[2:  ,0:-2] + Z[2:  ,1:-1] + Z[2:  ,2:])

    # Apply rules
    birth = (N==3) & (Z[1:-1,1:-1]==0)
    survive = ((N==2) | (N==3)) & (Z[1:-1,1:-1]==1)
    Z[...] = 0
    Z[1:-1,1:-1][birth | survive] = 1
    return Z

Z = np.random.randint(0,2,(50,50))
for i in range(100): Z = iterate(Z)
print(Z)",95
Numpy,Applied patterns and advanced,"Given an integer n and a 2D array X, select from X the rows which can be interpreted as draws from a multinomial distribution with n degrees, i.e., the rows which only contain integers and which sum to n. (★★★)","# Author: Evgeni Burovski

X = np.asarray([[1.0, 0.0, 3.0, 8.0],
                [2.0, 0.0, 1.0, 1.0],
                [1.5, 2.5, 1.0, 0.0]])
n = 4
M = np.logical_and.reduce(np.mod(X, 1) == 0, axis=-1)
M &= (X.sum(axis=-1) == n)
print(X[M])",97
Numpy,Indexing and selection,"Consider two arrays A and B of shape (8,3) and (2,2). How to find rows of A that contain elements of each row of B regardless of the order of the elements in B? (★★★)","# Author: Gabe Schwartz

A = np.random.randint(0,5,(8,3))
B = np.random.randint(0,5,(2,2))

C = (A[..., np.newaxis, np.newaxis] == B)
rows = np.where(C.any((3,1)).all(1))[0]
print(rows)",100
Numpy,Core array literacy,Create a 3x3 matrix filled with True (★☆☆),"Z = np.ones((3,3), dtype=bool); print(Z)",12
Numpy,Core array literacy,Create a null vector of size 10 but the fifth value which is 1 (★☆☆),"Z = np.zeros(10)
Z[4] = 1
print(Z)",12
Numpy,Core array literacy,Create a vector from 0 to 10 with step 0.5 (★☆☆),"Z = np.arange(0, 10.5, 0.5); print(Z)",12
Numpy,Core array literacy,Create a vector of integers 0..9 with dtype int32 (★☆☆),"Z = np.arange(10, dtype=np.int32); print(Z)",12
Numpy,Applied patterns and advanced,"Given a sorted array C that corresponds to a bincount, how to produce an array A such that np.bincount(A) == C? (★★★)","# Author: Jaime Fernández del Río

C = np.bincount([1,1,2,3,4,4,6])
A = np.repeat(np.arange(len(C)), C)
print(A)",85
Numpy,Core array literacy,Create a checkerboard 8x8 matrix using the tile function (★☆☆),"Z = np.tile( np.array([[0,1],[1,0]]), (4,4))
print(Z)",20
Numpy,Vectorization and broadcasting,"Standardize each column of a 2D array (zero mean, unit variance) safely (★★★)","Z = np.random.randn(5, 4)
mu = Z.mean(axis=0, keepdims=True)
sd = Z.std(axis=0, ddof=0, keepdims=True)
Zz = (Z - mu) / np.where(sd==0, 1, sd)
print(Zz.mean(0), Zz.std(0))",84
Numpy,Indexing and selection,Create random vector of size 10 and replace the maximum value by 0 (★★☆),"Z = np.random.random(10)
Z[Z.argmax()] = 0
print(Z)",54
Numpy,Vectorization and broadcasting,Sum each column of a 3x3 matrix (★☆☆),"Z = np.arange(9).reshape(3,3); print(Z.sum(axis=0))",16
Numpy,Core array literacy,Print the numpy version and the configuration (★☆☆),"print(np.__version__) 
np.show_config()",12
Numpy,Applied patterns and advanced,"How to get the dates of yesterday, today and tomorrow? (★☆☆)","yesterday = np.datetime64('today') - np.timedelta64(1)
today     = np.datetime64('today')
tomorrow  = np.datetime64('today') + np.timedelta64(1)",34
Numpy,Core array literacy,Import only the `arange` function as `ar` (★☆☆),from numpy import arange as ar,10
Numpy,Core array literacy,Convert a list of lists to a numpy array (★☆☆),"Z = np.array([[1,2],[3,4]]); print(Z)",10
Numpy,Core array literacy,Create a vector of ones of size 10 (★☆☆),Z = np.ones(10); print(Z),10
Numpy,Core array literacy,Import the numpy package under the name `np` (★☆☆),import numpy as np,10
Numpy,Core array literacy,Create a null vector of size 10 (★☆☆),"Z = np.zeros(10)
print(Z)",10
Numpy,Core array literacy,Create a 3x3 identity matrix (★☆☆),"Z = np.eye(3)
print(Z)",12
Numpy,Core array literacy,Create a vector with values ranging from 10 to 49 (★☆☆),"Z = np.arange(10,50)
print(Z)",12
Numpy,Core array literacy,Cast an integer array to float32 (★☆☆),Z = np.arange(5); print(Z.astype(np.float32)),12
Numpy,Core array literacy,Set elements 3..7 of a zero vector to 5 (★☆☆),Z = np.zeros(10); Z[3:8] = 5; print(Z),12
Numpy,Indexing and selection,Create mask for multiples of 3 from 0..29 (★☆☆),Z = np.arange(30); print(Z % 3 == 0),12
Numpy,Core array literacy,Reverse a vector (first element becomes last) (★☆☆),"Z = np.arange(50)
Z = Z[::-1]
print(Z)",12
Numpy,Vectorization and broadcasting,Compute cumulative sum of a vector 0..4 (★☆☆),Z = np.arange(5); print(np.cumsum(Z)),14
Numpy,Vectorization and broadcasting,Sort a random vector of size 10 in-place (★☆☆),Z = np.random.random(10); Z.sort(); print(Z),14
Numpy,Indexing and selection,Create a mask of values > 0.5 in a random 3x3 array (★☆☆),"Z = np.random.random((3,3)); print(Z > 0.5)",16
Numpy,Indexing and selection,Compute the trace of a 4x4 random matrix (★☆☆),"Z = np.random.random((4,4)); print(np.trace(Z))",18
Numpy,Core array literacy,Stack two 2x2 arrays vertically and horizontally (★☆☆),"a = np.ones((2,2)); b = np.zeros((2,2)); print(np.vstack([a,b])); print(np.hstack([a,b]))",20
Numpy,Applied patterns and advanced,Multiply a 5x3 matrix by a 3x2 matrix (real matrix product) (★☆☆),"Z = np.matmul(np.ones((5, 3)), np.ones((3, 2)))
print(Z)

# Alternative solution, in Python 3.5 and above
Z = np.ones((5,3)) @ np.ones((3,2))
print(Z)",26
Numpy,Vectorization and broadcasting,How to round away from zero a float array ? (★☆☆),"# Author: Charles R Harris

Z = np.random.uniform(-10,+10,10)
print(np.copysign(np.ceil(np.abs(Z)), Z))

# More readable but less efficient
print(np.where(Z>0, np.ceil(Z), np.floor(Z)))",30
Numpy,Indexing and selection,How to find common values between two arrays? (★☆☆),"Z1 = np.random.randint(0,10,10)
Z2 = np.random.randint(0,10,10)
print(np.intersect1d(Z1,Z2))",30
Numpy,Core array literacy,"Create a vector of size 10 with values ranging from 0 to 1, both excluded (★★☆)","Z = np.linspace(0,1,11,endpoint=False)[1:]
print(Z)",46
Einsum,Vectorization and broadcasting,"Given a batch of vectors $u$ and $v$, create a batch of matrices where every element of $u$ is multiplied by every element of $v$.","einsum(u, v, 'b i, b j -> b i j')",30
Einsum,Core array literacy,Swap the rows and columns of a 2D matrix $A$.,"einsum(A, 'i j -> j i')",20
Einsum,Core array literacy,Multiply two vectors element-wise and sum the results into a single scalar.,"einsum(v1, v2, 'i, i ->')",30
Einsum,Vectorization and broadcasting,"Given two matrices $A$ and $B$, compute the product and return only the values along the diagonal (row $i$, column $i$).","einsum(A, B, 'i k, k i -> i')",50
Einsum,Core array literacy,Reduce a 2D matrix into a 1D vector by summing along the vertical (row) axis.,"einsum(A, 'i j -> j')",20
Einsum,Vectorization and broadcasting,Take two matrices and compute the dot product for every possible pair of rows between them.,"einsum(X, Y, 'n d, m d -> n m')",35
Einsum,Vectorization and broadcasting,"For a batch of images, square every pixel value and sum them all up per image.","einsum(X, X, 'b c h w, b c h w -> b')",35
Einsum,Vectorization and broadcasting,"For each item in a batch, compute the similarity between its own internal feature vectors.","einsum(A, A, 'b i d, b j d -> b i j')",50
Einsum,Applied patterns and advanced,"Apply a single weight vector to every token in a batch, reducing the hidden dimension via a dot product.","einsum(X, v, 'b t d, d -> b t')",25
Einsum,Applied patterns and advanced,"Perform a triple-contraction: use a vector to select a weighted combination of a matrix, then dot that result with the vector again.","einsum(x, W, x, 'i, i j, j ->')",55
Einsum,Applied patterns and advanced,"Compare two feature maps by dot-producting the channel dimension at every spatial $(h, w)$ location.","einsum(F, G, 'c h w, c h w -> h w')",40
Einsum,Applied patterns and advanced,"Combine attention weights with values by summing over the ""keys"" dimension.","einsum(S, V, 'b h q k, b h k d -> b h q d')",50
Einsum,Vectorization and broadcasting,"Multiply rows by a weight vector and sum them, then normalize (weighted sum).","einsum(w, A, 'n, n d -> d') / w.sum()",35
Einsum,Core array literacy,"Create a matrix where every element $(i, j)$ is the product of $v1[i]$ and $v2[j]$.","einsum(v1, v2, 'i, j -> i j')",35
Einsum,Indexing and selection,Extract only the elements where the row index and column index are equal.,"einsum(A, 'i i -> i')",30
Einsum,Vectorization and broadcasting,Multiply a matrix by its own transpose to find the correlation between its columns.,"einsum(X, X, 'n d, n e -> d e')",40
Einsum,Applied patterns and advanced,Compute the variance/covariance by contracting the batch dimension of mean-centered data.,"einsum(X-mu, X-mu, 'n d, n e -> d e') / (n-1)",55
Einsum,Core array literacy,Standard matrix-matrix multiplication: sum over the shared inner dimension.,"einsum(C, D, 'i k, k j -> i j')",40
Einsum,Core array literacy,Collapse a 1D tensor into a single number by summing all elements.,"einsum(x, 'i ->')",15
Einsum,Core array literacy,Multiply a matrix by a vector to produce a new vector.,"einsum(A, b, 'i j, j -> i')",35
Einsum,Applied patterns and advanced,"Compute the ""raw"" attention scores by comparing Query and Key vectors across a batch.","einsum(Q, K, 'b h q d, b h k d -> b h q k')",45
Einsum,Applied patterns and advanced,Perform three matrix multiplications in a row in a single operation.,"einsum(A, B, C, 'i k, k m, m p -> i p')",45
Einsum,Applied patterns and advanced,"In a batch of tensors, multiply the inner matrices together per batch item.","einsum(T, U, 'a i j, a j k -> a i k')",45
Einsum,Indexing and selection,"For a batch of square matrices, get the sum of the diagonal for each matrix.","einsum(A, 'b i i -> b')",30
Einsum,Core array literacy,Flatten two matrices and find their dot product (element-wise multiplication then global sum).,"einsum(A, B, 'i j, i j ->')",30
Einsum,Vectorization and broadcasting,Apply a batch of matrices to a batch of vectors (one-to-one mapping).,"einsum(A, x, 'b i j, b j -> b i')",35
Einsum,Applied patterns and advanced,Blend image channels into a single spatial map using specific channel weights.,"einsum(img, w, 'c h w, c -> h w')",30
Einsum,Applied patterns and advanced,Compute the total sum of element-wise products between two 3D tensors.,"einsum(A, B, 'a b c, a b c ->')",30
Einsum,Indexing and selection,"Rearrange a 4D tensor (e.g., move the color channel from the second position to the last).","einsum(T, 'b c h w -> b h w c')",25
Einsum,Applied patterns and advanced,Transform the feature dimension of a sequence using a projection matrix.,"einsum(X, M, 'b t c, c f -> b t f')",35
Einsum,Indexing and selection,"For a batch of matrices, extract the diagonal values as a batch of vectors.","einsum(A, 'b i i -> b i')",35
Einsum,Core array literacy,Reduce a 2D matrix into a 1D vector by summing along the horizontal (column) axis.,"einsum(A, 'i j -> i')",20
Einsum,Applied patterns and advanced,Create a massive tensor where every element of $A$ is multiplied by every element of $B$.,"einsum(A, B, 'p q, r s -> p r q s')",90
Einsum,Vectorization and broadcasting,Perform standard matrix multiplication independently for every item in a batch.,"einsum(A, B, 'b i k, b k j -> b i j')",40
Einsum,Indexing and selection,Sum the diagonal elements of a single square matrix.,"einsum(A, 'i i ->')",30
Einsum,Core array literacy,"Given a vector v of size (n), create a square matrix where every element (i, j) is v[i] * v[j].","einsum(v, v, 'i, j -> i j')",35
Einsum,Core array literacy,"You have a batch of vectors x with shape (b, d) and a transformation matrix W of shape (d, d). Apply W to every vector in the batch.","einsum(x, W, 'b d, d e -> b e')",45
Einsum,Indexing and selection,"You have a 4D tensor activations with shape (b, h, s, d). Sum out the h dimension entirely to get a shape of (b, s, d).","einsum(activations, 'b h s d -> b s d')",30
Einsum,Vectorization and broadcasting,"Take a vector v of shape (d) and ""repeat"" it n times to create a matrix of shape (n, d).","einsum(v, 'd -> n d', n=n)",50
Einsum,Core array literacy,"Given a 3D tensor data of shape (b, t, d), calculate the average across the t dimension by summing it and dividing by its length.","einsum(data, 'b t d -> b d') / t",35
Einsum,Applied patterns and advanced,"You have input x (shape b, i), weights W1 (shape i, h), and W2 (shape h, o). Compute the full pass (x @ W1) @ W2 in one go.","einsum(x, W1, W2, 'b i, i h, h o -> b o')",80
Einsum,Vectorization and broadcasting,"For a batch of vectors v of shape (b, d), calculate the squared length (dot product with itself) for each vector.","einsum(v, v, 'b d, b d -> b')",40
Einsum,Indexing and selection,"You have a tensor T with shape (batch, head, seq, dim). Swap the head and seq axes.","einsum(T, 'b h s d -> b s h d')",45
Einsum,Applied patterns and advanced,"Given a query vector q of shape (d) and a memory matrix M of shape (n, d), find the similarity of q to every row in M.","einsum(q, M, 'd, n d -> n')",55
Einsum,Vectorization and broadcasting,"Given a batch of vectors x of shape (b, d), create a batch of matrices (b, d, d) showing how every feature interacts with every other feature.","einsum(x, x, 'b d, b e -> b d e')",65
Einsum,Applied patterns and advanced,"Project input x (shape b, t, d) into three different spaces (Q, K, V) simultaneously using a weight tensor W of shape (3, d, d).","einsum(x, W, 'b t d, n d e -> n b t e')",90
Einsum,Core array literacy,"Given a 3D tensor X of shape (b, t, d), sum all values belonging to the same t and d across all batches.","einsum(X, 'b t d -> t d')",35
Einsum,Core array literacy,Take any tensor X of any dimensionality and sum every single element into a single scalar.,"einsum(X, '... ->')",15
Einsum,Applied patterns and advanced,"Multiply an image img (shape c, h, w) by a per-channel scale factor s (shape c).","einsum(img, s, 'c h w, c -> c h w')",50
Einsum,Vectorization and broadcasting,"Perform the operation u @ v.T where u and v are vectors of shape (m) and (n), then add the result to matrix A (shape m, n).","einsum(u, v, 'i, j -> i j') + A",60
Einsum,Indexing and selection,"From a 3D tensor A of shape (b, n, n), extract only the very first element (0, 0) of each matrix in the batch.","einsum(A, 'b i j -> b i j')[:, 0, 0]",55
Einsum,Applied patterns and advanced,"Contract a weight tensor W (shape o, i, h, w) against an input X (shape i, h, w) to produce an output vector of shape (o).","einsum(W, X, 'o i h w, i h w -> o')",80
Einsum,Indexing and selection,"Given a 4D tensor X (shape b, c, h, w), sum all pixels and channels to get one value per batch item.","einsum(X, 'b c h w -> b')",40
Einsum,Vectorization and broadcasting,"You have a sequence x of shape (t, d). Create a 3D tensor (t, t, d) where each entry (i, j) is the element-wise product of vector i and vector j.","einsum(x, x, 'i d, j d -> i j d')",100
Einsum,Vectorization and broadcasting,"You have a batch of matrices B (shape b, i, j) and one constant matrix M (shape j, k). Multiply every matrix in the batch by M.","einsum(B, M, 'b i j, j k -> b i k')",65
Einsum,Core array literacy,"Given two matrices A and B of shape (n, n), compute the sum of the diagonal of their product without calculating the full product.","einsum(A, B, 'i j, j i ->')",60
Einsum,Vectorization and broadcasting,"Given queries (shape b, q, d) and keys (shape b, k, d), compute a score matrix of shape (b, q, k).","einsum(b q d, b k d -> b q k')",75
Einsum,Indexing and selection,"Take a 3D tensor img (shape c, h, w) and flatten the spatial dimensions into one, resulting in shape (c, h*w).","einops.rearrange(img, 'c h w -> c (h w)')",40
Einsum,Applied patterns and advanced,"You have two tensors P and Q of shape (b, h, n, d). For each batch and head, compute the similarity matrix of shape (n, n).","einsum(P, Q, 'b h n d, b h m d -> b h n m')",85
Einsum,Applied patterns and advanced,"For a 5D video tensor v (shape b, t, c, h, w), average out everything except the batch and channel dimensions.","einsum(v, 'b t c h w -> b c') / (t*h*w)",70
Einsum,Core array literacy,Subtract the transpose of a square matrix A from itself to find the anti-symmetric part.,"einsum(A, 'i j -> i j') - einsum(A, 'j i -> i j')",45
Einsum,Indexing and selection,"Given x (shape b, t, d), sum across the d dimension using a weight vector w (shape d) to get shape (b, t).","einsum(x, w, 'b t d, d -> b t')",50
Einsum,Applied patterns and advanced,"In an MLP, multiply hidden states h (shape b, t, hidden) by output weights W (shape hidden, out).","einsum(h, W, 'b t h, h d -> b t d')",65
Einsum,Applied patterns and advanced,"Compute the scalar result of $v^T M v$ where v is shape (d) and M is shape (d, d).","einsum(v, M, v, 'i, i j, j ->')",85
Einsum,Indexing and selection,"Create an identity-like batch: given a vector of scales s (shape b), create a batch of diagonal matrices (b, n, n).","einsum(s, torch.eye(n), 'b, i j -> b i j')",70
Einsum,Applied patterns and advanced,"Given a sequence x of shape (t, d), compute the dot product between each token and the token immediately following it.","einsum(x[:-1], x[1:], 't d, t d -> t')",60
Einsum,Applied patterns and advanced,"You have a multi-head tensor x (shape b, t, h, d) and a head-importance weight w (shape h). Weighted-sum the heads into shape (b, t, d).","einsum(x, w, 'b t h d, h -> b t d')",70
Einsum,Vectorization and broadcasting,"For each item in a batch of vectors v (shape b, d), compute v @ v.T and sum those resulting matrices together.","einsum(v, v, 'b i, b j -> i j')",65
Einsum,Applied patterns and advanced,"Multiply matrix A (shape i, j) by a diagonal matrix (represented as vector v, shape j), then by matrix B (shape j, k).","einsum(A, v, B, 'i j, j, j k -> i k')",85
Einsum,Core array literacy,"Using a permutation matrix P (shape n, n) and a vector v (shape n), reorder the elements of v.","einsum(P, v, 'i j, j -> i')",50